import React, { useState } from "react";
import { BsList, BsPerson, BsBag } from "react-icons/bs";
import { Dropdown } from "react-bootstrap";
import { useCart } from "../../pages/Cart/CartContext";
import CartPopover from "../../pages/Cart/CartPopover";
import { Navbar, Container, Nav, Offcanvas, Button } from "react-bootstrap";
import "./MainHeader.css";
const MainHeader: React.FC = () => {
  const [showOffcanvas, setShowOffcanvas] = useState(false);

  const handleClose = () => setShowOffcanvas(false);
  const handleShow = () => setShowOffcanvas(true);

  const { cartCount, cartItems } = useCart();

  // 導航連結陣列
  const navItems = [
    { title: "首頁", href: "/" },
    { title: "關於我們", href: "/about" },
    { title: "聯絡我們", href: "/contact" },
    { title: "商品總覽", href: "/ProductList" },
    { title: "最新消息", href: "/latest" },
  ];

  // 左右連結分組
  const navLeft = navItems.slice(1, 3); // 關於我們, 聯絡我們
  const navRight = navItems.slice(3, 5); // 商品總覽, 最新消息

  return (
    <header className="MainHeader">
      <Navbar bg="light" expand="lg" className="CustomNavbar">
        <Container className="HeaderGridContainer">
          <div className="HeaderGridItem HeaderGridLeft">
            <Button
              variant="link"
              onClick={handleShow}
              className="MenuToggle d-lg-none"
            >
              <BsList size={30} />
            </Button>

            <Nav className="MainNavGroup MainNavGroup-left d-none d-lg-flex">
              {navLeft.map((item) => (
                <Nav.Link key={item.title} href={item.href}>
                  {item.title}
                </Nav.Link>
              ))}
            </Nav>
          </div>

          {/* 中間LOGO ICON */}
          <Navbar.Brand href="/" className="HeaderLogo">
            <svg
              width="50"
              height="50"
              viewBox="0 0 120 120"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M68.5501 0C74.0561 7.73024e-06 78.5196 4.46352 78.5196 9.96954C78.5196 12.3075 77.7148 14.4575 76.3671 16.1576H76.457L60.2995 44.5193L43.1105 16.1576H43.2004C41.8528 14.4575 41.0479 12.3075 41.0479 9.96954C41.0479 4.46353 45.5113 9.95087e-06 51.0174 0C54.8028 0 58.0955 2.10974 59.7837 5.21755C61.472 2.10974 64.7647 0 68.5501 0ZM60.4713 16.5014C59.427 16.5014 58.5806 17.4249 58.5806 18.5641C58.5806 19.3118 58.9453 19.9666 59.4913 20.3283L60.2995 44.5193L61.2648 20.4367C61.9126 20.1094 62.3622 19.3941 62.3622 18.5641C62.3622 17.4249 61.5155 16.5014 60.4713 16.5014Z"
                fill="black"
              />
              <path
                d="M18.9496 23.9203C20.651 18.6838 26.2753 15.818 31.5119 17.5194C33.7355 18.2419 35.5314 19.6718 36.7319 21.4789L36.7597 21.3934L58.7404 45.5244L26.4551 53.1078L26.4828 53.0222C24.4495 53.7786 22.156 53.8798 19.9325 53.1574C14.696 51.4558 11.8302 45.8315 13.5316 40.5949C14.7014 36.9948 17.7254 34.5152 21.2028 33.8699C18.7688 31.304 17.7798 27.5205 18.9496 23.9203ZM32.1467 36.7029C31.8241 37.696 32.4408 38.7865 33.5242 39.1386C34.2354 39.3696 34.9708 39.2251 35.4835 38.8176L58.7404 45.5244L36.1346 37.1643C36.0236 36.4471 35.4822 35.7985 34.6927 35.5421C33.6094 35.19 32.4694 35.7098 32.1467 36.7029Z"
                fill="black"
              />
              <path
                d="M107.237 41.2193C108.754 46.5121 105.694 52.0329 100.401 53.5507C98.1542 54.1951 95.8652 54.014 93.8598 53.1871L93.8846 53.2735L62.168 45.5594L84.693 21.2188L84.7178 21.3053C85.9807 19.5412 87.8254 18.1749 90.0729 17.5304C95.3656 16.0127 100.886 19.073 102.404 24.3658C103.448 28.0046 102.327 31.7512 99.8048 34.2307C103.258 34.9969 106.194 37.5806 107.237 41.2193ZM89.1478 38.0019C88.8601 36.9981 87.7389 36.4389 86.6439 36.7529C85.9252 36.9591 85.3963 37.4901 85.1991 38.1146L62.168 45.5594L85.5837 39.8494C86.0769 40.3819 86.8884 40.6168 87.6863 40.388C88.7813 40.074 89.4357 39.0056 89.1478 38.0019Z"
                fill="black"
              />
              <path
                d="M26.7675 78.6614C22.3131 75.425 21.3256 69.1904 24.5619 64.7358C25.9362 62.8444 27.8511 61.5782 29.9407 60.9949L29.8679 60.9421L59.6102 47.4941L56.8458 80.5427L56.773 80.4897C56.864 82.6573 56.2516 84.8698 54.8773 86.7614C51.6409 91.2157 45.4063 92.2033 40.9518 88.9668C37.8893 86.7418 36.4656 83.0996 36.9265 79.593C33.7339 81.115 29.83 80.8864 26.7675 78.6614ZM43.0027 70.0601C43.8475 70.6739 45.0752 70.4243 45.7448 69.5027C46.1842 68.8978 46.274 68.1536 46.045 67.5401L59.6102 47.4941L44.6738 66.4099C43.9574 66.2939 43.1733 66.6085 42.6854 67.2799C42.0158 68.2015 42.1579 69.4463 43.0027 70.0601Z"
                fill="black"
              />
              <path
                d="M81.1247 88.2788C76.6703 91.5154 70.4356 90.5277 67.1992 86.0734C65.8249 84.182 65.2125 81.9695 65.3034 79.802L65.2307 79.8548L61.6318 47.4126L61.632 47.4127L75.0063 67.4631C74.6746 68.1087 74.7314 68.9516 75.2193 69.6231C75.8888 70.5448 77.1165 70.7943 77.9614 70.1804C78.8061 69.5667 78.9482 68.322 78.2786 67.4004C77.8391 66.7955 77.1591 66.4801 76.5048 66.5084L61.6321 47.4126L92.2085 60.2542L92.1358 60.3071C94.2254 60.8904 96.1399 62.1566 97.5145 64.0481C100.751 68.5025 99.7634 74.7372 95.309 77.9735C92.2465 80.1986 88.3426 80.4272 85.15 78.9052C85.611 82.4118 84.1872 86.0538 81.1247 88.2788Z"
                fill="black"
              />
              <path
                d="M33.6571 119.458C33.4437 119.458 33.2731 119.415 33.1451 119.33C33.0384 119.244 32.9851 119.138 32.9851 119.01C32.9851 118.882 33.0491 118.775 33.1771 118.69C33.3264 118.604 33.5077 118.572 33.7211 118.594C34.2331 118.636 34.6064 118.658 34.8411 118.658C35.4811 118.658 35.9931 118.562 36.3771 118.37C36.7611 118.156 37.0171 117.804 37.1451 117.314C37.3584 116.546 37.4651 113.634 37.4651 108.578C37.4651 103.522 37.3584 100.61 37.1451 99.8417C37.0171 99.3511 36.7611 99.0097 36.3771 98.8177C35.9931 98.6044 35.4811 98.4977 34.8411 98.4977C34.6064 98.4977 34.2331 98.5191 33.7211 98.5617H33.5931C33.4011 98.5617 33.2517 98.5191 33.1451 98.4337C33.0384 98.3484 32.9851 98.2417 32.9851 98.1137C32.9851 98.0071 33.0384 97.9111 33.1451 97.8257C33.2731 97.7404 33.4437 97.6977 33.6571 97.6977H38.0731C38.3717 97.6977 38.6384 97.7404 38.8731 97.8257C39.1291 97.8897 39.2997 97.9857 39.3851 98.1137C41.6251 101.698 43.6197 104.716 45.3691 107.17C47.1184 109.602 49.1451 112.172 51.4491 114.882C51.5557 115.031 51.6624 115.106 51.7691 115.106C51.9397 115.106 52.0251 114.967 52.0251 114.69L52.0571 100.322C52.0571 99.6604 51.8011 99.1911 51.2891 98.9137C50.7984 98.6364 50.1904 98.4977 49.4651 98.4977C49.2091 98.4977 48.8891 98.5191 48.5051 98.5617H48.4091C48.2384 98.5617 48.1104 98.5191 48.0251 98.4337C47.9397 98.3484 47.8971 98.2417 47.8971 98.1137C47.8971 98.0071 47.9397 97.9111 48.0251 97.8257C48.1317 97.7404 48.2704 97.6977 48.4411 97.6977H56.0571C56.2277 97.6977 56.3557 97.7404 56.4411 97.8257C56.5477 97.9111 56.6011 98.0177 56.6011 98.1457C56.6011 98.2737 56.5477 98.3804 56.4411 98.4657C56.3344 98.5511 56.1851 98.5831 55.9931 98.5617C55.8651 98.5404 55.6624 98.5297 55.3851 98.5297C54.7877 98.5297 54.2971 98.6791 53.9131 98.9777C53.5291 99.2764 53.3371 99.7244 53.3371 100.322V118.082C53.3371 118.53 53.2411 118.871 53.0491 119.106C52.8784 119.319 52.6544 119.426 52.3771 119.426C52.0997 119.426 51.8757 119.308 51.7051 119.074C49.8704 116.642 47.2997 113.122 43.9931 108.514C41.1344 104.546 39.6091 102.434 39.4171 102.178C39.3317 102.028 39.2251 101.954 39.0971 101.954C38.9264 101.954 38.8411 102.082 38.8411 102.338C38.7557 103.98 38.7131 106.274 38.7131 109.218C38.7131 111.202 38.7344 112.951 38.7771 114.466C38.8411 115.98 38.9157 116.93 39.0011 117.314C39.1291 117.804 39.3851 118.156 39.7691 118.37C40.1531 118.562 40.6651 118.658 41.3051 118.658C41.5397 118.658 41.9131 118.636 42.4251 118.594H42.5531C42.7451 118.594 42.8944 118.636 43.0011 118.722C43.1077 118.807 43.1611 118.914 43.1611 119.042C43.1611 119.148 43.0971 119.244 42.9691 119.33C42.8624 119.415 42.7024 119.458 42.4891 119.458H33.6571ZM63.0346 119.49C62.0106 119.49 61.0292 119.266 60.0906 118.818C59.1519 118.37 58.3839 117.687 57.7866 116.77C57.2106 115.852 56.9226 114.743 56.9226 113.442C56.9226 112.119 57.2212 110.999 57.8186 110.082C58.4159 109.164 59.1732 108.482 60.0906 108.034C61.0292 107.564 62.0106 107.33 63.0346 107.33C64.0586 107.33 65.0399 107.564 65.9786 108.034C66.9172 108.482 67.6852 109.164 68.2826 110.082C68.8799 110.999 69.1786 112.119 69.1786 113.442C69.1786 114.743 68.8799 115.852 68.2826 116.77C67.6852 117.687 66.9172 118.37 65.9786 118.818C65.0399 119.266 64.0586 119.49 63.0346 119.49ZM63.0346 118.658C64.1439 118.658 65.0292 118.178 65.6906 117.218C66.3519 116.258 66.6826 114.988 66.6826 113.41C66.6826 111.852 66.3412 110.594 65.6586 109.634C64.9972 108.652 64.1226 108.162 63.0346 108.162C61.9466 108.162 61.0612 108.652 60.3786 109.634C59.7172 110.594 59.3866 111.852 59.3866 113.41C59.3866 114.967 59.7172 116.236 60.3786 117.218C61.0612 118.178 61.9466 118.658 63.0346 118.658ZM73.1418 105.218C72.6511 105.218 72.2245 105.047 71.8618 104.706C71.5205 104.343 71.3498 103.916 71.3498 103.426C71.3498 102.914 71.5205 102.487 71.8618 102.146C72.2245 101.783 72.6511 101.602 73.1418 101.602C73.6325 101.602 74.0485 101.783 74.3898 102.146C74.7525 102.487 74.9338 102.914 74.9338 103.426C74.9338 103.916 74.7525 104.343 74.3898 104.706C74.0485 105.047 73.6325 105.218 73.1418 105.218ZM70.8058 119.458C70.5925 119.458 70.4218 119.415 70.2938 119.33C70.1871 119.244 70.1338 119.138 70.1338 119.01C70.1338 118.86 70.1978 118.743 70.3258 118.658C70.4538 118.572 70.6351 118.551 70.8698 118.594C71.5098 118.722 71.9365 118.38 72.1498 117.57C72.2778 117.1 72.3418 116.375 72.3418 115.394C72.3418 114.69 72.3311 114.146 72.3098 113.762L72.2778 111.618C72.2778 111.042 72.1818 110.583 71.9898 110.242C71.8191 109.879 71.5311 109.698 71.1258 109.698C70.9125 109.698 70.7418 109.666 70.6138 109.602C70.5071 109.538 70.4538 109.452 70.4538 109.346C70.4538 109.26 70.5071 109.175 70.6138 109.09C70.7418 108.983 70.9125 108.908 71.1258 108.866C71.7871 108.695 72.4698 108.343 73.1738 107.81C73.2591 107.767 73.4085 107.682 73.6218 107.554C73.8351 107.404 74.0058 107.33 74.1338 107.33C74.4325 107.33 74.5818 107.458 74.5818 107.714L74.5178 108.994L74.3898 111.202C74.3471 111.991 74.3258 113.036 74.3258 114.338C74.3258 115.852 74.3791 116.93 74.4858 117.57C74.5498 117.932 74.6671 118.199 74.8378 118.37C75.0085 118.54 75.2538 118.626 75.5738 118.626C75.7231 118.626 75.8511 118.615 75.9578 118.594L76.1498 118.562C76.3205 118.562 76.4485 118.604 76.5338 118.69C76.6405 118.775 76.6938 118.882 76.6938 119.01C76.6938 119.138 76.6298 119.244 76.5018 119.33C76.3951 119.415 76.2351 119.458 76.0218 119.458H73.3658H70.8058ZM77.6413 109.346C77.6413 109.26 77.6946 109.175 77.8013 109.09C77.9293 108.983 78.1 108.908 78.3133 108.866C78.9746 108.695 79.6573 108.343 80.3613 107.81C80.4466 107.767 80.596 107.682 80.8093 107.554C81.0226 107.404 81.1933 107.33 81.3213 107.33C81.62 107.33 81.7693 107.458 81.7693 107.714C81.7693 108.055 81.7586 108.364 81.7373 108.642V108.706C81.7373 108.834 81.7693 108.908 81.8333 108.93C81.8973 108.951 81.9826 108.908 82.0893 108.802C82.5586 108.311 83.0813 107.948 83.6573 107.714C84.2546 107.458 84.8093 107.33 85.3213 107.33C85.5986 107.33 85.8226 107.362 85.9933 107.426C86.5053 107.596 86.7613 107.906 86.7613 108.354C86.7613 108.674 86.6333 108.962 86.3773 109.218C86.1213 109.474 85.8226 109.602 85.4813 109.602C85.2893 109.602 85.1506 109.58 85.0653 109.538C84.6173 109.388 84.2333 109.314 83.9133 109.314C83.3586 109.314 82.868 109.484 82.4413 109.826C82.036 110.167 81.748 110.668 81.5773 111.33C81.5133 112.482 81.4813 113.495 81.4813 114.37C81.4813 115.735 81.5453 116.802 81.6733 117.57C81.7373 117.932 81.8546 118.199 82.0253 118.37C82.196 118.54 82.4413 118.626 82.7613 118.626C82.9106 118.626 83.0386 118.615 83.1453 118.594L83.3373 118.562C83.508 118.562 83.636 118.604 83.7213 118.69C83.828 118.775 83.8813 118.882 83.8813 119.01C83.8813 119.138 83.8173 119.244 83.6893 119.33C83.5826 119.415 83.4226 119.458 83.2093 119.458H77.9933C77.78 119.458 77.6093 119.415 77.4813 119.33C77.3746 119.244 77.3213 119.138 77.3213 119.01C77.3213 118.86 77.3853 118.743 77.5133 118.658C77.6413 118.572 77.8226 118.551 78.0573 118.594C78.3773 118.658 78.644 118.604 78.8573 118.434C79.092 118.242 79.252 117.954 79.3373 117.57C79.444 117.036 79.4973 116.194 79.4973 115.042L79.4653 111.618C79.4653 111.042 79.3693 110.583 79.1773 110.242C79.0066 109.879 78.7186 109.698 78.3133 109.698C78.1 109.698 77.9293 109.666 77.8013 109.602C77.6946 109.538 77.6413 109.452 77.6413 109.346Z"
                fill="black"
              />
            </svg>
          </Navbar.Brand>

          {/* 右側區塊 */}
          <div className="HeaderGridItem HeaderGridRight">
            <Nav className="MainNavGroup MainNavGroup-right d-none d-lg-flex">
              {navRight.map((item) => (
                <Nav.Link key={item.title} href={item.href}>
                  {item.title}
                </Nav.Link>
              ))}
            </Nav>

            {/* 右側功能圖標 (Icons) */}
            <Nav className="Icons">
              <Nav.Link href="/account" className="p-0 ms-3">
                <BsPerson size={30} />
              </Nav.Link>
            </Nav>
            {/*  購物車 Dropdown 區域  */}
            <Dropdown
              align="end"
              autoClose="outside"
              className="ms-3"
              key={cartCount}
              style={{ cursor: "pointer" }}
            >
              <Dropdown.Toggle
                as="div"
                className="p-0 position-relative cursor-pointer nav-link"
              >
                <BsBag size={25} />
                {cartCount > 0 && (
                  <span className="cart-count">
                    {cartCount > 99 ? "99+" : cartCount}
                  </span>
                )}
              </Dropdown.Toggle>

              <Dropdown.Menu className="p-0 border-0 shadow-lg CartDropdownMenu">
                <CartPopover />
              </Dropdown.Menu>
            </Dropdown>
          </div>
        </Container>
      </Navbar>

      {/* 側邊欄區塊 */}
      <Offcanvas
        show={showOffcanvas}
        onHide={handleClose}
        placement="start"
        className="d-lg-none"
      >
        <Offcanvas.Header closeButton>
          <Offcanvas.Title>Noir.</Offcanvas.Title>
        </Offcanvas.Header>
        <Offcanvas.Body>
          <Nav className="flex-column offcanvas-nav-links">
            {navItems.map((item) => (
              <Nav.Link key={item.title} href={item.href} onClick={handleClose}>
                {item.title}
              </Nav.Link>
            ))}
          </Nav>
        </Offcanvas.Body>
      </Offcanvas>
    </header>
  );
};

export default MainHeader;
